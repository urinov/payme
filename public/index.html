<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Toâ€˜lov test sahifasi</title>
</head>
<body>
  <h1>Toâ€˜lov tizimi test</h1>

  <div>
    <label>Toâ€˜lov summasi (soâ€˜m):</label>
    <input type="number" id="amount" value="11000" />
  </div>

  <button onclick="startPayme()">ðŸ’¸ Payme orqali toâ€˜lov</button>
  <button onclick="startClick()">ðŸ’³ Click orqali toâ€˜lov</button>

  <pre id="log"></pre>

  <script>
    async function createOrder() {
      const resp = await fetch('/api/new-order');
      const data = await resp.json();
      return data.order_id;
    }

    function log(msg) {
      document.getElementById('log').textContent += msg + "\n";
    }

    async function startPayme() {
      const orderId = await createOrder();
      const amountSoâ€˜m = Number(document.getElementById('amount').value);
      const amountTiyin = amountSoâ€˜m * 100;

      log(`Payme: order_id=${orderId}, amount=${amountTiyin}`);

      const resp = await fetch(`/api/checkout-url?order_id=${orderId}&amount=${amountTiyin}`);
      const data = await resp.json();

      if (data.url) {
        window.location.href = data.url;
      } else {
        log('Xatolik: ' + JSON.stringify(data));
      }
    }

    async function startClick() {
      const orderId = await createOrder();
      const amountSoâ€˜m = Number(document.getElementById('amount').value);
      const amountTiyin = amountSoâ€˜m * 100;

      log(`Click: order_id=${orderId}, amount=${amountTiyin}`);

      const resp = await fetch(`/api/click-url?order_id=${orderId}&amount=${amountTiyin}`);
      const data = await resp.json();

      if (data.url) {
        window.location.href = data.url;
      } else {
        log('Xatolik: ' + JSON.stringify(data));
      }
    }
  </script>
</body>
</html>
